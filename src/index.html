<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="shortcut icon" type="image/x-icon" href="images/QQ_Music_favicon.png" />
        <title>QQ音乐 - 中国最新最全免费正版高品质音乐平台</title>
        <!-- <link rel="stylesheet" href="./css/slideShow.css"> -->
        <link rel="stylesheet" href="./css/index.css">
    </head>

    <body>
        <header>
            <div class="homeTop">
                <i class="music_logo"></i>
                <a href="javascript:;" class="btn_download">下载APP</a>
            </div>
            <nav class="header_nav">
                <!-- <a href="javascript:;" class="active">推荐</a>
            <a href="javascript:;">排行榜</a>
            <a href="javascript:;">搜索</a> -->
                <span class="active">推荐</span>
                <span>排行榜</span>
                <span>搜索</span>
            </nav>
        </header>
        <div class="content">
            <ul>
                <li class="active select">
                    <!-- <section class="slide">
                    <div class="slideImg">
                        <img class="active" src="images/img-1.jpg" alt="">
                        <img src="images/img-2.jpg" alt="">
                        <img src="images/img-3.jpg" alt="">
                        <img src="images/img-4.jpg" alt="">
                        <ul>
                            <li class="select"></li>
                            <li></li>
                            <li></li>
                            <li></li>
                        </ul>
                    </div>
                </section> -->
                    <section class="station">
                        <h2>电台</h2>
                        <ul>
                            <li class="music_play">
                                <img src="./images/hot-1.jpg" alt="">
                                <br><span>一人一首招牌歌</span>
                            </li>
                            <li class="music_play">
                                <img src="./images/hot-2.jpg" alt="">
                                <br><span>热歌</span>
                            </li>
                        </ul>
                    </section>
                    <section class="station hot">
                        <h2>热门歌单</h2>
                        <ul>
                            <li class="music_play">
                                <img src="./images/like-1.jpg" alt="">
                                <br><span>催泪大杀器</span>
                            </li>
                            <li class="music_play">
                                <img src="./images/like-2.jpg" alt="">
                                <br><span>纳尼？这些华语歌手...</span>
                            </li>
                            <li class="music_play">
                                <img src="./images/like-3.jpg" alt="">
                                <br><span>精选内地十大民谣歌手</span>
                            </li>
                            <li class="music_play">
                                <img src="./images/like-4.jpg" alt="">
                                <br><span>2017嘻哈精选</span>
                            </li>
                            <li class="music_play">
                                <img src="./images/like-5.jpg" alt="">
                                <br><span>浮光掠影 ACG纯音乐</span>
                            </li>
                            <li class="music_play">
                                <img src="./images/like-6.jpg" alt="">
                                <br><span>trip-hop单曲大推荐</span>
                            </li>
                        </ul>
                    </section>
                    <section class="more_music">
                        <p><a href="javascript:;">去客户端发现更多好音乐 ></a></p>
                    </section>
                    <footer>
                        <p><a href="https://y.qq.com/?ADTAG=myqq&nomobile=1#type=index">查看电脑版网页</a></p>
                        <p><a href="javascript:;"><img src="./images/logo_footer.png" alt=""></a></p>
                        <p>Copyright &copy; 1998-2017 Tencent. All Rights Reserved</p>
                        <p>联系电话：0755-86013388 QQ群：55209235</p>
                    </footer>
                </li>
                <li class="hot_music">
                    <div class="hot_header music_play">
                        <img src="./images/hot_music.jpg" alt="">
                        <div class="hot_header_block">
                            <p>巅峰热歌榜 第37周</p>
                            <span>2017-09-14更新</span>
                            <a href="javascript:;"></a>
                        </div>
                    </div>
                    <div class="musicList"></div>
                    <div class="loading">
                        <img src="./images/loading.gif" alt="">
                    </div>
                </li>
                <li class="search">
                    <div class="search_wrap">
                        <div class="search_input">
                            <img src="./images/search.png" alt="">
                            <form action="">
                                <!-- 
                                如果form表单有且仅有一个input，按下回车表单会默认提交然后刷新页面
                                解决办法：
                                1.去掉form
                                2.如果必须要有form
                                (1).加一个隐藏的文本框
                                (2).阻止表单提交 添加onsubmit事件 返回false
                             -->
                                <input id="hiddenText" type="text" style="display:none" />
                                <input id="search" type="search" placeholder="搜索歌曲、歌单、专辑">
                            </form>
                            <span class="search_cancel">取消</span>
                        </div>
                    </div>
                    <div class="hot_search">
                        <span>热门搜索</span>
                        <ul class="hot_search_list">
                            <li data-id="1">Ready For It?</li>
                            <li data-id="2">我在夜里偷看过一颗星星</li>
                            <li data-id="3">SHE</li>
                            <li data-id="4">普通人</li>
                            <li data-id="5">Baby U Know</li>
                            <li data-id="6">英雄归来</li>
                            <li data-id="9">云长</li>
                            <li data-id="7">谁比我有范儿 (舒服版)</li>
                            <li data-id="8">哭给你听</li>
                            <li data-id="10">当冬夜渐暖</li>
                        </ul>
                    </div>
                    <div class="musicList"></div>
                </li>
            </ul>
        </div>
        <!-- <script src="./js/jquery-3.2.1.min.js"></script> -->
        <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
        <script>
            alert(1);
        </script>
        <!-- <script src="./js/slideShow.js"></script> -->
        <!-- <script src="./js/index.js"></script> -->
        <script>
            $(function () {
                // 轮播图
                alert('轮播..');
                // slideShow();

                // 选项卡切换
                $('.header_nav').on('click', 'span', function (e) {
                    alert('click执行了')
                    let curSpan = e.target;
                    let index = $(curSpan).index();
                    $(curSpan).addClass('active').siblings().removeClass('active');
                    $('.content>ul>li').eq(index).addClass('select').siblings().removeClass('select');

                    if (index === 1) {
                        alert('执行了');
                        // 排行榜请求
                        $.get('./music.json').then(function (result) {
                            alert('ajax请求进来了');
                            if ($('.content>ul>li').eq(index).attr('data-downloaded') === 'yes') {
                                // 防止无限请求
                                return;
                            }
                            let musicList = result;
                            let $fullList = $(`<div class="fullList">
                        <p>
                            <img src="./images/QQ_Music_favicon.png" />
                            <span>查看完整榜单</span>
                        </p>
                    </div>`)
                            musicList.forEach(function (item) {
                                let $a = $(`<a href="./play/play.html?id=${item.id}">
                            <div class="musicIndex">${item.id}</div>
                            <div class="musicContent">
                                <h3>${item.name}</h3>
                                <p>${item.singer}<span>${item.description}</span></p>
                            </div>
                        </a>`);
                                $('.hot_music>.musicList').append($a);
                            });
                            // 请求过的标志
                            $('.content>ul>li').eq(index).attr('data-downloaded', 'yes');
                            $('.hot_music>.musicList').append($fullList);
                            $('.loading').remove();
                        }, function (err) {
                            console.log('error:' + err);
                        })
                    }
                })

                // 搜索框逻辑
                $('#search').on('focus', function () {
                    // 获得焦点时取消按钮出现，热门搜索隐藏
                    $('.search_cancel').css('display', 'block').animate({
                        opacity: 1
                    }, 600);
                    $('.hot_search').css('display', 'none');
                }).on('blur', function () {
                    // 失去焦点时取消按钮隐藏
                    $('.search_cancel').animate({
                        opacity: 0
                    }, 600);
                    setTimeout(function () {
                        $('.search_cancel').css('display', 'none');
                    }, 600)
                    // 失去焦点 并value为空 热门搜索出现
                    if ($('#search').val() === '') {
                        $('.hot_search').css('display', 'block');
                    }
                });
                // $('.search_cancel').on('click',function(){
                //     $('.search_cancel').animate({
                //         opacity:0
                //     },600);
                // });

                // 热门歌曲点击搜索
                $('.hot_search .hot_search_list').on('click', function (e) {
                    if (e.target.tagName === 'LI') {
                        // 热门搜索隐藏
                        $('.hot_search').css('display', 'none');
                        // 输入框显示点击的内容
                        $('#search').val($(e.target).text());
                        // 显示搜索结果
                        showList($(e.target).text());
                    }
                })
                // 回车搜索
                document.addEventListener('keyup', function (e) {
                    var keyword = $('#search').val();
                    if (e.keyCode === 13) {
                        // 将前一次结果清空
                        $('.search .musicList').empty();
                        showList(keyword);
                    }
                })
            });

            // 轮播图
            // function slideShow(){
            //     let slide=$('.slide');
            //     let slideImgs=$('.slideImg img');
            //     let slideLis=$('.slideImg ul li');
            //     new ChangeImg(slide,slideLis,slideImgs,2500);
            // };
            // 发送请求核对信息
            async function search(keyword) {
                var searchResult = [];
                var database;
                // 异步操作
                if (keyword == '') return;
                await $.get('./music.json').then(function (result) {
                    database = result;
                    var search_result = database.filter(function (item) {
                        return item.name.indexOf(keyword) >= 0
                            || item.name.indexOf(keyword.toLowerCase()) >= 0
                            || item.name.indexOf(keyword.toUpperCase()) >= 0
                            || item.singer.indexOf(keyword) >= 0
                            || item.singer.indexOf(keyword.toLowerCase()) >= 0
                            || item.singer.indexOf(keyword.toUpperCase()) >= 0
                            || item.description.indexOf(keyword) >= 0
                            || item.description.indexOf(keyword.toLowerCase()) >= 0
                            || item.description.indexOf(keyword.toUpperCase()) >= 0;
                    })
                    searchResult = search_result.slice(0);
                }, function (err) {
                    console.log('error:' + err);
                });
                // 等异步操作完成后再返回
                return searchResult;
            }
            // 显示搜索结果
            function showList(keyword) {
                search(keyword).then(function (res) {
                    // 没有输入关键字
                    if (res == undefined) {
                        return;
                    }
                    // 没找到结果
                    if (res.length === 0) {
                        if ($('.no_result').length !== 0) {
                            return;
                        }
                        $('.search .musicList').append('<div class="no_result">暂无结果</div>');
                    } else {
                        res.forEach(function (item) {
                            let $li = $(`<a href="./play/play.html?id=${item.id}">
                        <div class="musicContent">
                            <h3>${item.name}</h3>
                            <p>${item.singer}<span>${item.description}</span></p>
                        </div>
                    </a>`);
                            $('.search .musicList').append($li);
                            // $('.search .musicList a').each(function(i,v){
                            //     if($(v).html()===$li.html()){
                            //         $(v).remove();
                            //     }
                            // })
                        })
                    }
                })

                // oninput/onpropertchange value变化就触发，
                // 而onchange触发事件必须满足两个条件：
                // a）当前对象属性改变，并且是由键盘或鼠标事件激发的（脚本触发无效）
                // b）当前对象失去焦点(onblur)
                $('#search').on('change input propertychange', function () {
                    if ($('#search').val() == '') {
                        // 清空搜索结果
                        $('.search .musicList').empty();
                    }
                });
            }
        </script>
        <script>
            alert(2)
        </script>
    </body>

</html>